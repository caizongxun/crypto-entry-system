//@version=5
indicator("Signal Confirmation Filter v1.0", overlay=true, max_bars_back=500)

rsi_period = input.int(14, title="RSI Period")
macd_fast = input.int(12, title="MACD Fast")
macd_slow = input.int(26, title="MACD Slow")
macd_signal = input.int(9, title="MACD Signal")

rsi = ta.rsi(close, rsi_period)
[macd_line, macd_signal_line, macd_hist] = ta.macd(close, macd_fast, macd_slow, macd_signal)

rsi_buy_zone = rsi < 50 and rsi > rsi[1]
rsi_sell_zone = rsi > 50 and rsi < rsi[1]

macd_buy_signal = macd_hist > 0 and macd_line > macd_signal_line
macd_sell_signal = macd_hist < 0 and macd_line < macd_signal_line

buy_confirm = rsi_buy_zone and macd_buy_signal
sell_confirm = rsi_sell_zone and macd_sell_signal

plot(rsi, title="RSI", color=color.blue, linewidth=2)
hline(70, linestyle=hline.style_dashed, color=color.red, title="Overbought")
hline(30, linestyle=hline.style_dashed, color=color.green, title="Oversold")
hline(50, linestyle=hline.style_dotted, color=color.gray, title="Middle")

plot(macd_line, title="MACD", color=color.orange, linewidth=2)
plot(macd_signal_line, title="MACD Signal", color=color.red, linewidth=2)
plot(macd_hist, title="MACD Histogram", color=color.new(color.gray, 50), style=plot.style_columns)
hline(0, linestyle=hline.style_dashed, color=color.black)

plotshape(buy_confirm, title="Buy Confirm", style=shape.circle, location=location.bottom, color=color.green, size=size.small)
plotshape(sell_confirm, title="Sell Confirm", style=shape.circle, location=location.top, color=color.red, size=size.small)

alertcondition(buy_confirm, title="Buy Confirmation", message="BUY CONFIRMED - RSI + MACD alignment")
alertcondition(sell_confirm, title="Sell Confirmation", message="SELL CONFIRMED - RSI + MACD alignment")