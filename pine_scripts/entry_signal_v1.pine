//@version=5
indicator("Crypto Entry Signal v1.0", overlay=true, max_bars_back=500)

bb_period = input.int(20, title="BB Period")
bb_std = input.float(2.0, title="BB Standard Deviation")
volume_threshold = input.float(1.2, title="Volume Threshold Multiplier")

bb_basis = ta.sma(close, bb_period)
bb_dev = ta.stdev(close, bb_period)
bb_upper = bb_basis + (bb_dev * bb_std)
bb_lower = bb_basis - (bb_dev * bb_std)

avg_volume = ta.sma(volume, 20)
volume_high = volume > (avg_volume * volume_threshold)

basis_slope = bb_basis - bb_basis[1]

upper_touch = close >= bb_upper * 0.98 and close <= bb_upper
lower_touch = close <= bb_lower * 1.02 and close >= bb_lower

upper_break = close > bb_upper and high[1] <= bb_upper[1]
lower_break = close < bb_lower and low[1] >= bb_lower[1]

buy_signal = false
sell_signal = false

if volume_high and basis_slope > 0
    if lower_touch or (lower_break and close > bb_basis)
        buy_signal := true

if volume_high and basis_slope < 0
    if upper_touch or (upper_break and close < bb_basis)
        sell_signal := true

plotshape(buy_signal, title="Buy Signal", style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)
plotshape(sell_signal, title="Sell Signal", style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)

plot(bb_basis, title="BB Basis", color=color.blue, linewidth=2)
plot(bb_upper, title="BB Upper", color=color.gray, linewidth=1)
plot(bb_lower, title="BB Lower", color=color.gray, linewidth=1)

fill(plot(bb_upper), plot(bb_lower), title="BB Fill", color=color.new(color.blue, 85))

alertcondition(buy_signal, title="Buy Signal Alert", message="BUY signal - BB lower touch/break with trend")
alertcondition(sell_signal, title="Sell Signal Alert", message="SELL signal - BB upper touch/break with trend")